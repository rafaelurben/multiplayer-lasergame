<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayergame</title>

    <link rel="stylesheet" href="/static/external/bootstrap-5.2.3.min.css">
    <link rel="stylesheet" href="/static/css/main.css">

    <script src="/static/external/jquery-3.6.1.min.js"></script>
    <script src="/static/external/bootstrap-5.2.3.bundle.min.js"></script>
    <script src="/static/external/konva-8.3.14.min.js"></script>
    <script src="/static/js/connection.js"></script>
    <script src="/static/js/canvas.js"></script>
    <script src="/static/js/game.js"></script>
</head>

<body>
    <!-- Content -->
    <div class="w-100 h-100 d-flex flex-column">
        <!-- Menubar / Header -->
        <div class="w-100 p-2 m-0 d-flex flex-row border-bottom align-items-center">
            <div class="me-3">
                <h3 class="mb-0 d-none d-sm-block">Multiplayergame</h3>
                <h3 class="mb-0 d-block d-sm-none">Game</h3>
            </div>
            <div class="flex-grow-1 text-end me-1">
                <span id="header_status">Not connected</span>
                <span id="header_team" class="hidden">â– </span>
            </div>
            <div class="modeblock mode_player mode_spectator mode_master hidden ms-2">
                <button class="btn btn-danger" onclick="sock.leave()" title="Leave game">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill:white" d="M160 96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96C43 32 0 75 0 128V384c0 53 43 96 96 96h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H96c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32h64zM504.5 273.4c4.8-4.5 7.5-10.8 7.5-17.4s-2.7-12.9-7.5-17.4l-144-136c-7-6.6-17.2-8.4-26-4.6s-14.5 12.5-14.5 22v72H192c-17.7 0-32 14.3-32 32l0 64c0 17.7 14.3 32 32 32H320v72c0 9.6 5.7 18.2 14.5 22s19 2 26-4.6l144-136z" />
                    </svg>
                </button>
            </div>
            <div class="modeblock mode_player mode_spectator mode_master mode_connected ms-2">
                <button id="show_qrcode" class="btn btn-light hidden" data-bs-toggle="modal" data-bs-target="#qrcontainer" title="Show QR code">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                        <!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path style="fill:black" d="M48 32C21.5 32 0 53.5 0 80v96c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48H48zm80 64v64H64V96h64zM48 288c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48V336c0-26.5-21.5-48-48-48H48zm80 64v64H64V352h64zM256 80v96c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48H304c-26.5 0-48 21.5-48 48zm64 16h64v64H320V96zm32 352v32h32V448H352zm96 0H416v32h32V448zM416 288v32H352V288H256v96 96h64V384h32v32h96V352 320 288H416z" />
                    </svg>
                </button>
            </div>
        </div>
        <!-- Maincontent -->
        <div id="maincontent" class="d-flex flex-wrap flex-grow-1">
            <!-- Connect screen -->
            <div class="modeblock mode_connected hidden p-3">
                <div class="row row-cols-lg-auto g-3 align-items-center">
                    <div class="col-12">
                        <button class="btn btn-light" onclick="sock.joinAsSpectator()">Connect as spectator</button>
                    </div>
                    <div class="col-12">
                        <div id="lobby_join_player_form" class="input-group">
                            <input id="nameinput" class="form-control" type="text" name="name" placeholder="Enter your name">
                            <button class="btn btn-primary" onclick="sock.joinAsPlayer()">Join as player</button>
                        </div>
                        <div id="lobby_join_player_disabled_message" class="hidden">
                            <span class="text-gray">Joining as a player is currently disabled. This might be the case if a game is running or because it was manually disabled.</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Player screen -->
            <div class="modeblock mode_player hidden d-flex">
                <!-- Team selection buttons -->
                <div id="teamselectcontainer" class="stateblock state_lobby row gap-2 m-2 flex-grow-1">
                    <!-- Teamselect-buttons are created in game.js on page load -->
                </div>
                <!-- Team selection disabled -->
                <div class="stateblock state_lobby_teamlock m-2">
                    <span class="text-gray">The host has disabled team selection.</span>
                </div>
            </div>
            <!-- Spectator screen -->
            <div class="modeblock mode_spectator mode_master hidden p-0 d-flex">
                <!-- Game -->
                <div id="spectatorcanvascontainer" class="stateblock state_ingame flex-grow-1 d-flex justify-content-center">
                    <!-- Canvas is created by konvajs -->
                </div>
                <!-- Lobby -->
                <div class="stateblock state_lobby state_lobby_teamlock d-flex flex-column flex-grow-1">
                    <!-- Player list (Lobby) -->
                    <div id="playerlist" class="row gap-2 m-2 flex-grow-1">
                        <!-- Playerlist is created in game.js -->
                    </div>
                    <!-- Master control bar -->
                    <div class="modeblock mode_master d-flex flex-row flex-wrap gap-2 p-2">
                        <button id="toggle_joining" class="btn btn-light" onclick="sock.action('toggle_joining')">Toggle joining</button>
                        <button id="toggle_teamlock" class="btn btn-light" onclick="sock.action('toggle_teamlock')">Toggle teamlock</button>
                        <span class="flex-grow-1"></span>
                        <button class="btn btn-light" onclick="sock.action('start_game')">Start game</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- QR code modal -->
    <div id="qrcontainer" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-dark">
                    <h5 class="modal-title">Join the game</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body bg-dark">
                    <p>
                        Scan the QR code with your phone or 
                        <a id="qrcode_link" class="text-light" href="" target="_blank">copy this link</a>
                        to join the game.
                    </p>
                    <img id="qrcode_image" class="w-100">
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        window.game = new Game();
        window.sock = new GameSocket(window.game);
    </script>
</body>

</html>
